---
title: "Less Stress, More Regress"
author: "David Moreno, Saurav Sharma, Zubair Lalani"
date: "2024-12-06"
output: html_document
---

```{r setup, echo = FALSE, message = FALSE, warning = FALSE}
options(scipen = 1, digits = 4, width = 80, fig.align = "center")
```

DELETE THIS SECTION BEFORE SUBMISSION, JUST USING IT AS A REFERENCE FOR STRUCTURE

you should use the format:
  
- Introduction
- Methods
- Results
- Discussion

The **introduction** section should relay what you are attempting to accomplish. It should provide enough background to your work such that a reader would not need this directions document to understand what you are doing. Basically, assume the reader is mostly familiar with the concepts from the course, but not this project. [For the Midterm Assignment, the Introduction section is allowed to simply be the exercise statements as I have typed them later in this file. Yes, a direct copy.]

The **methods** section should contain the majority of your “work.” This section will contain the bulk of the `R` code that is used to generate the results. Your `R` code is not expected to be perfect idiomatic `R`, but it is expected to be understood by a reader without too much effort. Use RMarkdown and code comments to your advantage to explain your code if needed. [For the Midterm Assignment, you may type a sentence or two explaining what you are attempting to do and then the code chunk that does it. Repeat as necessary to tell a coherent story about your method. That is, it would be clear to display your code in a few smaller chunks explaining along the way, as opposed to one giant chunk with a large paragraph trying to describe the whole thing at once.]

The **results** section should contain numerical or graphical summaries of your results as they pertain to the goal of each study. [For the Midterm Assignment, while the code chunks appear in Methods, the actual plots, numeric tables, etc. would appear in Results.]

The **discussion** section should contain discussion of your results. The discussion section should contain discussion of your results. Potential topics for discussion are suggested at the end of each simulation study section, but they are not meant to be an exhaustive list. These simulation studies are meant to be explorations into the principles of statistical modeling, so do not limit your responses to short, closed form answers as you do in homework assignments. Use the potential discussion questions as a starting point for your response. [For the Midterm Assignment, This is where you may give your summary of what you observe in the Results. The "Potential Topics" are meant to get your thoughts flowing and give you ideas about what to discuss. This section will be just your typed responses with no new code or results.]

- Your resulting `.html` file will be considered a self-contained “report,” which is the material that will determine the majority of your grade. Be sure to visibly include all `R` code and output that is *relevant*. (You should not include irrelevant code you tried that resulted in error or did not answer the question correctly.)
- Grading will be based on a combination of completing the required tasks, discussion of results, `R` usage, RMarkdown usage, and neatness and organization. For full details see the provided rubric.

# Introduction
Stress is a universal experience that can have profound consequences on health and well-being. Identifying the factors that contribute to heightened stress levels can empower individuals and organizations to make informed adjustments to daily routines, potentially improving quality of life.

In this project, we analyze a dataset that measures perceived stress levels, along with various physiological, behavioral, and personality-based predictors. The dataset comprises information on 100 participants over a 30-day period—totaling 3,000 records—and includes variables such as the Perceived Stress Scale (PSS) score, personality traits aligned with the OCEAN model, sleep patterns, phone usage metrics, and measures of physical activity and mobility.

Why focus on this data? Stress can be influenced by multiple facets of human behavior and environment. Understanding the extent to which these factors correlate with stress may guide targeted interventions—like improving sleep quality, reducing screen time, or fostering specific personality-driven coping strategies—to help manage and mitigate stress. By modeling the relationships between PSS scores and a variety of predictors, we aim to pinpoint which factors are most strongly associated with elevated stress, and in doing so, enhance our understanding of how stress emerges in everyday life.

Our end goal is to build and refine a regression model to identify key predictors of perceived stress, communicate the logic behind our modeling steps, and interpret the results in a manner that is both statistically sound and practically meaningful.


# Methods
In this section, we outline the steps taken to explore, prepare, and model the data using linear regression techniques. We begin by importing the dataset, examining its structure, and checking for data quality issues. If there are missing values, we must decide how to handle them. For simplicity, we will remove rows containing any missing values.

```{r load-data, echo=TRUE, message=FALSE, warning=FALSE}
data = read.csv("stress_detection.csv", header=TRUE)

str(data)

summary(data$PSS_score)

# remove any rows with missing values
data = data[complete.cases(data), ]

# Confirm the number of observations remaining after removal
nrow(data)
# TODO: remove this note later but wanted to point out that the number of rows after removing missing values is still 3000, which means that there are no missing values... which makes it seem likely that the dataset we are using was generated. 
```
With the dataset now cleaned of incomplete records, we proceed to fit an initial linear regression model. We start with a relatively comprehensive model that includes personality traits (Openness, Conscientiousness, Extraversion, Agreeableness, Neuroticism), sleep-related variables (sleep_duration, PSQI_score), and measures related to daily behavior and physiology (e.g., call_duration, num_calls, num_sms, screen_on_time, skin_conductance, accelerometer, mobility_radius, mobility_distance). Our goal is to identify which factors are most strongly associated with perceived stress (PSS_score).

```{r}
initial_model = lm(PSS_score ~ Openness + Conscientiousness + Extraversion + Agreeableness + 
                    Neuroticism + sleep_duration + PSQI_score + call_duration + num_calls + 
                    num_sms + screen_on_time + skin_conductance + accelerometer + 
                    mobility_radius + mobility_distance, data = data)

summary(initial_model)
```
After fitting our initial model, we must evaluate the residual diagnostics to ensure the model’s assumptions are met.

```{r}
diagnostics = function(model, pcol = "grey", lcol = "dodgerblue", alpha = 0.05, plotit = TRUE, testit = TRUE) {
  output = list()
  
  if (testit) {
    shapiro_test = shapiro.test(residuals(model))
    p_val = shapiro_test$p.value
    decision = ifelse(p_val < alpha, "Reject", "Fail to Reject")
    output$p_val = p_val
    output$decision = decision
  }
  
  if (plotit) {
    par(mfrow = c(1, 2))
    plot(model$fitted.values, residuals(model), 
         col = pcol, pch = 19, 
         xlab = "Fitted", ylab = "Residuals", 
         main = "Residuals vs Fitted")
    abline(h = 0, col = lcol)
    qqnorm(residuals(model), col = pcol, pch = 19, main = "Normal Q-Q Plot")
    qqline(residuals(model), col = lcol)
  }
  
  return(output)
}

diag_results = diagnostics(initial_model)
diag_results
```
**Residuals vs. Fitted Plot (Left):**  
Ideally, this plot should show residuals scattered randomly around a horizontal line at zero with no clear pattern. In our results, the residuals hover around zero without a pronounced trend or curvature, which suggests the absence of a strong nonlinear relationship. However, the residuals exhibit substantial vertical spread. This indicates that while the model does not show obvious systematic bias, there is notable variance in the residuals. In other words, the model might be missing some complexity or relevant predictors that could help reduce the unexplained variability in PSS_score. 

**Normal Q-Q Plot (Right):**  
A Normal Q-Q plot checks whether residuals are normally distributed. If the residuals followed a normal distribution closely, the points would lie near the diagonal reference line. In our plot, the points deviate substantially, particularly in the tails, creating a clear S-shaped pattern. This indicates that our residuals are not normally distributed. They appear to have heavier tails and possibly skewness. The violation of this assumption may affect inference (e.g., confidence intervals and p-values) but does not necessarily invalidate the model’s predictive usefulness. However, it signals that we may consider alternative transformations, robust regression methods, or additional modeling approaches to handle the non-normality in the residuals.


After examining the diagnostics, we observed that the residuals are not normally distributed and show significant deviation in the Q-Q plot. One common approach to address this issue is to try a transformation of the response variable to achieve more normally distributed residuals. Given that PSS_score is strictly positive, we can attempt a logarithmic transformation. This will compress the scale of the response and may reduce the heavy tails observed in the residual distribution.

Therefore, we:
1. Create a new variable log_PSS which is the natural logarithm of PSS_score.
2. Fit a new, initial model using log_PSS as the response
3. Re-check diagnostics on the refined model.

```{r}
data$log_PSS = log(data$PSS_score)

log_model = lm(log_PSS ~ Openness + Conscientiousness + Extraversion + Agreeableness +
               Neuroticism + sleep_duration + PSQI_score + call_duration + num_calls + 
               num_sms + screen_on_time + skin_conductance + accelerometer + 
               mobility_radius + mobility_distance, data = data)

summary(log_model)

diag_results_log = diagnostics(log_model)
diag_results_log
```

Although this approach compressed the values in the Q-Q plot, it did not change the distribution of points compared to the reference line asdf;lkjasdlkfj